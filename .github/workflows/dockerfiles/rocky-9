FROM rockylinux/rockylinux:9

RUN echo fastestmirror=1 >> /etc/dnf/dnf.conf
RUN dnf clean all
RUN dnf install -y epel-release
RUN dnf --enablerepo=crb install -y fuse-devel
RUN dnf install -y rpm-build rpm-devel rpmlint make python3 bash diffutils patch rpmdevtools m4 tar xz dash git which make gcc gcc-c++ fuse gmp-devel ncurses-devel sqlite-devel re2-devel squashfuse dash wget iproute
# Squashfuse build dependences
RUN dnf install -y fuse3-devel libattr-devel libzstd-devel lz4-devel xz-devel lzo-devel zlib-devel

RUN rpmdev-setuptree

WORKDIR /build
ENV VERSION=1.70.0
ENV RUST_FOLDER="rust-$VERSION-x86_64-unknown-linux-gnu"
ENV RUST_TAR="$RUST_FOLDER.tar.gz"
RUN wget "https://static.rust-lang.org/dist/$RUST_TAR"
RUN tar -xf $RUST_TAR
RUN sh ./$RUST_FOLDER/install.sh --verbose
